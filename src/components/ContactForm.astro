---
interface Props {
  lang: 'es' | 'en' | 'ca';
}

const { lang } = Astro.props;

const translations = {
  es: {
    name: 'Nombre',
    email: 'Email',
    message: 'Mensaje',
    send: 'Enviar mensaje',
    sending: 'Enviando...',
    success: '¡Mensaje enviado! Te responderé pronto.',
    error: 'Error al enviar. Intenta de nuevo.',
  },
  en: {
    name: 'Name',
    email: 'Email',
    message: 'Message',
    send: 'Send message',
    sending: 'Sending...',
    success: 'Message sent! I\'ll reply soon.',
    error: 'Error sending. Try again.',
  },
  ca: {
    name: 'Nom',
    email: 'Email',
    message: 'Missatge',
    send: 'Enviar missatge',
    sending: 'Enviant...',
    success: 'Missatge enviat! Et respondré aviat.',
    error: 'Error en enviar. Torna a provar.',
  },
};

const t = translations[lang];
---

<form id="contact-form" class="space-y-4 max-w-lg mx-auto">
  <div>
    <input
      type="text"
      name="name"
      placeholder={t.name}
      required
      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-[#3b82f6] focus:ring-2 focus:ring-blue-200 outline-none transition"
    />
  </div>

  <div>
    <input
      type="email"
      name="email"
      placeholder={t.email}
      required
      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-[#3b82f6] focus:ring-2 focus:ring-blue-200 outline-none transition"
    />
  </div>

  <div>
    <textarea
      name="message"
      rows="5"
      placeholder={t.message}
      required
      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-[#3b82f6] focus:ring-2 focus:ring-blue-200 outline-none transition resize-none"
    ></textarea>
  </div>

  <button
    type="submit"
    class="w-full bg-[#3b82f6] hover:bg-[#2563eb] text-white font-semibold py-3 px-6 rounded-lg transition transform hover:-translate-y-0.5"
  >
    {t.send}
  </button>

  <div id="form-message" class="hidden text-center font-medium"></div>
</form>

<script define:vars={{ t, lang }}>
  const form = document.getElementById('contact-form');
  const message = document.getElementById('form-message');
  const button = form.querySelector('button[type="submit"]');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const data = {
      name: formData.get('name'),
      email: formData.get('email'),
      message: formData.get('message'),
      language: lang,
    };

    // UI feedback
    button.textContent = t.sending;
    button.disabled = true;
    message.className = 'hidden';

    try {
      const response = await fetch('/api/send-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok) {
        message.className = 'text-green-600 font-medium';
        message.textContent = t.success;
        form.reset();
      } else {
        throw new Error(result.error || 'Error');
      }
    } catch (error) {
      message.className = 'text-red-600 font-medium';
      message.textContent = t.error;
    } finally {
      button.textContent = t.send;
      button.disabled = false;
    }
  });
</script>
